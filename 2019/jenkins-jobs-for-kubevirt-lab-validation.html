<!doctype html>
<html lang="en">

  <head>
    <!-- Adding Adobe Analytics -->
    <script id="dpal" src="//www.redhat.com/ma/dpal.js" type="text/javascript"></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1, shrink-to-fit=no" >
    <meta name="go-import" content="kubevirt.io/kubevirt git https://github.com/kubevirt/kubevirt">
    <meta name="go-import" content="kubevirt.io/client-go git https://github.com/kubevirt/client-go">
    <meta name="go-import" content="kubevirt.io/containerized-data-importer git https://github.com/kubevirt/containerized-data-importer">
    <meta name="go-import" content="kubevirt.io/qe-tools git https://github.com/kubevirt/qe-tools">
    <meta name="go-import" content="kubevirt.io/machine-remediation git https://github.com/kubevirt/machine-remediation">
    <meta name="go-import" content="kubevirt.io/cloud-provider-kubevirt git https://github.com/kubevirt/cloud-provider-kubevirt">
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png">
    <link rel="manifest" href="/assets/favicon/site.webmanifest">
    <link rel="mask-icon" href="/assets/favicon/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#00aba9">
    <meta name="theme-color" content="#ffffff">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="https://kubevirt.io//2019/jenkins-jobs-for-kubevirt-lab-validation.html">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet">
    
    <title>Jenkins Jobs for KubeVirt lab validation | KubeVirt.io</title>
    <!-- # Opengraph protocol properties: https://ogp.me/ -->
    <meta name="author" content="Pablo Iranzo GÃ³mez" >
    <meta property="og:type" content="article" >
    <meta name="twitter:card" content="summary">
    <meta name="description" content="How Jenkins is leveraged for automation at KubeVirt Cloud Image Builder and Lab Validation">
    <meta name="keywords" content="news" >
    <meta property="og:title" content="Jenkins Jobs for KubeVirt lab validation | KubeVirt.io">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://kubevirt.io//2019/jenkins-jobs-for-kubevirt-lab-validation.html" >
    <meta property="og:image" content="https://kubevirt.io//assets/images/KubeVirt_logo_color.png">
    <meta property="og:description" content="How Jenkins is leveraged for automation at KubeVirt Cloud Image Builder and Lab Validation" >
    <meta property="og:site_name" content="KubeVirt.io" >
    <meta property="og:article:author" content="Pablo Iranzo GÃ³mez" >
    <meta property="og:article:published_time" content="2019-10-31 00:00:00 +0000" >
    <meta name="twitter:title" content="Jenkins Jobs for KubeVirt lab validation | KubeVirt.io">
    <meta name="twitter:description" content="How Jenkins is leveraged for automation at KubeVirt Cloud Image Builder and Lab Validation">

    <link type="application/atom+xml" rel="alternate" href="https://kubevirt.io//feed.xml" title="KubeVirt.io" />
</head>


  <body>
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top" role="navigation">
        <a class="navbar-brand" href="/">
    <img src="/assets/images/KubeVirt_logo_color.svg" class="navbar-brand-image d-inline-block align-top" alt="KubeVirt.io">
  </a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <i class="fas fa-th-large"></i>
  </button>
  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav">
      

      
        <li  class="nav-item active" >
          <a class="nav-link text-uppercase" href="/blogs/">Blogs</a>
        </li>
      
        <li  class="nav-item" >
          <a class="nav-link text-uppercase" href="/videos/">Videos</a>
        </li>
      
        <li  class="nav-item" >
          <a class="nav-link text-uppercase" href="//kubevirt.io/user-guide">Docs</a>
        </li>
      
        <li  class="nav-item" >
          <a class="nav-link text-uppercase" href="/labs/">Labs</a>
        </li>
      
        <li  class="nav-item" >
          <a class="nav-link text-uppercase" href="/community/">Community</a>
        </li>
      
      <li class='nav-item'>
          <form action="/search.html" method="get">
            <i class="fas fa-search docs-search"></i>
            <input type="text" id="search-input" class="docs-search--input" placeholder="Type to search" name="query">
            <input type="submit" value="ðŸ”" style="display: none;">
          </form>
      </li>
    </ul>
  </div>

    </nav>

    <main role="main" style="margin-top: 60px;">
      <div class="container">
  <div class="row">
    <div class="col">
      <div class="post">
        <header class="post-header">
          <h1></h1>
          <h1 class="post-title">Jenkins Jobs for KubeVirt lab validation</h1>
          <div class="post-info">
            <span class="post-author">Author: Pablo Iranzo GÃ³mez</span>
            <div>
              <span class="post-meta">Publication Date: October 31, 2019  </span>
            </div>
            <div>
              <span class="post-category-name">
                Category: news
              </span>
            </div>
          </div>
        </header>
        <article class="post-content">
          <h2 id="introduction">Introduction</h2>

<p><a href="https://jenkins.io/">Jenkins</a> is an opensource automation server that allows to define jobs, triggers, etc to validate that certain conditions are met.</p>

<p>Jobs can run either after a trigger has been received (for example from a repo merge or PR), periodically to validate that a previous â€˜validatedâ€™ job is still â€˜validâ€™ or even manually to force refresh of information.</p>

<h2 id="community-repositories">Community repositories</h2>

<p>Outside of the main KubeVirt binaries, there are other repos that are involved in the project ecosystem have tests to validate the information provided on them.</p>

<p>The community repositories include:</p>

<ul>
  <li><a href="https://github.com/kubevirt/kubevirt.github.io">KubeVirt website</a></li>
  <li><a href="https://github.com/kubevirt/kubevirt-tutorial">KubeVirt tutorial</a></li>
  <li><a href="https://github.com/metal3-io/metal3-io.github.io">Katacoda Scenarios</a></li>
  <li><a href="https://github.com/kubevirt/community">Community repo</a></li>
  <li><a href="https://github.com/kubevirt/cloud-image-builder">Cloud Image Builder</a></li>
</ul>

<p>Those repos contain useful information for new users, like the <code class="highlighter-rouge">try-it</code> scenarios, the Laboratories, <a href="https://katacoda.com/kubevirt">Katacoda scenarios</a>, Community supporting files (like logos, proposals, etc).</p>

<h2 id="the-jobs">The jobs</h2>

<p>Our Jenkins instance is hosted at CentOS OpenShift instance and itâ€™s available at <a href="https://jenkins-kubevirt.apps.ci.centos.org/">https://jenkins-kubevirt.apps.ci.centos.org/</a></p>

<p>There, weâ€™ve two jobs weâ€™re currently refining to get better results:</p>

<ul>
  <li><a href="https://jenkins-kubevirt.apps.ci.centos.org/job/cloud-image-builder/">Cloud Image Builder</a>, which builds, according to the repo defined above contents what the AWS, GCP and Minikube images contain (binaries, KubeVirt version, Minikube version).
    <ul>
      <li>The <a href="https://jenkins-kubevirt.apps.ci.centos.org/job/cloud-image-builder/job/master/lastSuccessfulBuild/artifact/new-images.json">resulting AWS images</a> are copied to each region.</li>
      <li>The resulting GCP images are also copied</li>
      <li>The resulting Minikube image is used for lab validation</li>
    </ul>
  </li>
  <li><a href="https://jenkins-kubevirt.apps.ci.centos.org/job/Lab%20Validation/">Lab Validation</a> which uses above created images with the contents of the <code class="highlighter-rouge">/tests</code> folder at <a href="https://github.com/kubevirt/kubevirt.github.io/tree/master/tests">Kubevirt.github.io repository</a> to spin up instances and validate that the contents of the labs are valid</li>
</ul>

<p>Both tests can be executed periodically (by default each day), causing a repository rescan to detect new changes and later validation of them and only on branch <code class="highlighter-rouge">master</code>.</p>

<p>If youâ€™re curious about what Jenkins does, check the file <code class="highlighter-rouge">JenkinsFile</code> at the root of each repository:</p>

<ul>
  <li><a href="https://github.com/kubevirt/kubevirt.github.io/blob/master/Jenkinsfile">https://github.com/kubevirt/kubevirt.github.io/blob/master/Jenkinsfile</a></li>
  <li><a href="https://github.com/kubevirt/cloud-image-builder/blob/master/Jenkinsfile">https://github.com/kubevirt/cloud-image-builder/blob/master/Jenkinsfile</a></li>
</ul>

<p>Both of them define pipelines so that runs can be executed in parallel for each one of the environments: GCP, AWS, Minikube.</p>

<h2 id="cloud-image-builder">Cloud Image Builder</h2>

<p>Cloud Image Builder has primarily two steps:</p>

<ul>
  <li><a href="https://github.com/kubevirt/cloud-image-builder/blob/master/shell/build.sh">build</a></li>
  <li><a href="https://github.com/kubevirt/cloud-image-builder/blob/master/shell/publish.sh">publish</a></li>
</ul>

<p>Build takes most of the logic, as it prepares <code class="highlighter-rouge">virtctl</code> and <code class="highlighter-rouge">kubectl</code> binaries and then for each one of the environments it executes the required ansible playbooks:</p>

<ul>
  <li><code class="highlighter-rouge">${environment}-provision.yml</code>: Which creates the VM instance on the provider (for Minikube, itâ€™s a VM inside GCP)</li>
  <li><code class="highlighter-rouge">${environment}-setup.yml</code>: Which configures the VM instance (repositories, packages, first-boot script, KubeVirt installation, virtctl binaries, etc)</li>
  <li><code class="highlighter-rouge">${environment}-mkimage.yml</code>: Which creates an image out of the instance generated by steps above</li>
  <li><code class="highlighter-rouge">${environment}-publish.yml</code>: Which, for GCP and AWS, publishes the generated image in above step</li>
</ul>

<p>Once the images have been published, the jobs end and instances are removed from the providers.</p>

<h2 id="lab-validation">Lab Validation</h2>

<p>Lab Validation is meant to check that the labs described in the website are working on the three platforms (GCE, AWS, Minikube).</p>

<p>In opposition to <a href="/2019/prow-jobs-for-kubevirt.html">KubeVirt Tutorial</a>, it doesnâ€™t use <code class="highlighter-rouge">mdsh</code> yet for extracting the actual commands out of the lab text and uses ansible playbooks to imitate the lab execution:</p>

<ul>
  <li><a href="https://github.com/kubevirt/kubevirt.github.io/blob/master/tests/ansible/lab1.yml">https://github.com/kubevirt/kubevirt.github.io/blob/master/tests/ansible/lab1.yml</a></li>
  <li><a href="https://github.com/kubevirt/kubevirt.github.io/blob/master/tests/ansible/lab2.yml">https://github.com/kubevirt/kubevirt.github.io/blob/master/tests/ansible/lab2.yml</a></li>
</ul>

<p>In addition, it contains files for also setting up the instance for running the tests (<code class="highlighter-rouge">${environment}-provision.yml</code>) and doing the later cleanup (<code class="highlighter-rouge">$environment-cleanup.yml</code>).</p>

<p>The first playbook, does create a new instance on the environment being checked using the images created by the Cloud Image Builder, so this means that not only the labs are validated, but also the images generated are validated to detect possible defects like missing binaries, wrongly installed software, etc.</p>

<p>The biggest part on the lab validation is with the <a href="https://github.com/kubevirt/kubevirt.github.io/blob/master/tests/shell/lab.sh">lab.sh</a> script, which accepts the lab being executed and the environment as parameters, and takes care of provisioning the instance, run the lab and perform cleanup afterwards.</p>

        </article>

        

<a class="twitter-share-button" href="https://twitter.com/intent/tweet?text=Jenkins Jobs for KubeVirt lab validation&url=https://www.kubevirt.io/2019/jenkins-jobs-for-kubevirt-lab-validation.html&screen_name=kubevirt" aria-label="Share this on Twitter">
  <i class="fab fa-twitter mr-1"></i> Tweet
</a>
<hr/>


        

      </div>
    </div>
  </div>
</div>

    </main>

    <footer class="footer" role="footer">
      <div class="container-fluid">
  <div class="row justify-content-center">
    <div class="col-sm-12 col-md-5">
      <p class="privacy-statement text-sm-left" style="text-align: center;">
        &copy; <script type="text/javascript"> document.write(new Date().getFullYear()); </script> KubeVirt | <a href="/privacy" class="privacy-statement-link">Privacy Statement</a>
      </p>
    </div>
    <div class="col-sm-12 col-md-5" style="text-align: center;">
      <p class="text-md-right">
        <a href="https://twitter.com/kubevirt" aria-label="Visit us on Twitter" class="link-social-twitter">
          <i class="fab fa-twitter fa-lg"></i>
        </a>
        <a href="https://github.com/kubevirt" aria-label="View our repo on GitHub" class="link-social-github">
          <i class="fab fa-github fa-lg"></i>
        </a>
        <a href="https://groups.google.com/forum/#!forum/kubevirt-dev" aria-label="Send us an email" class="link-social-mail">
          <i class="fas fa-envelope fa-lg"></i>
        </a>
        <a href="https://calendar.google.com/calendar/embed?src=18pc0jur01k8f2cccvn5j04j1g%40group.calendar.google.com&ctz=Etc%2FGMT"
            aria-label="See our calendar"
            class="link-social-calendar">
          <i class="fas fa-calendar fa-lg"></i>
        </a>
      </p>
    </div>
  </div>
  <div class="row">
    <div class="col offset-md-1 text-sm-left footer-licensing" style="text-align: center;">
      Code licensed under <a href="https://github.com/kubevirt/kubevirt/blob/master/LICENSE">Apache 2.0</a>,
      site under <a href="https://github.com/kubevirt/kubevirt.github.io/blob/master/LICENSE">MIT</a>.
    </div>
  </div>
</div>

    </footer>

    <script defer src="https://use.fontawesome.com/releases/v5.1.0/js/all.js" integrity="sha384-3LK/3kTpDE/Pkp8gTNp2gR/2gOiwQ6QaO7Td0zV76UFJVhqLl4Vl3KL1We6q6wR9" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>
    <script id="dsq-count-scr" src="//kubevirt-io.disqus.com/count.js" async></script>
    <script src="/js/kubevirt-io.js"></script>

    <!-- This comes from DTM/DPAL and must be latest entry in body-->

    <script type="text/javascript">
        if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
            _satellite.pageBottom();
        }
    </script>
  </body>
</html>
