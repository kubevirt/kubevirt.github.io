<!doctype html>
<html lang="en">

  <head>
    <!-- Adding Adobe Analytics -->
    <script id="dpal" src="//www.redhat.com/ma/dpal.js" type="text/javascript"></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1, shrink-to-fit=no" >
    <meta name="go-import" content="kubevirt.io/kubevirt git https://github.com/kubevirt/kubevirt">
    <meta name="go-import" content="kubevirt.io/client-go git https://github.com/kubevirt/client-go">
    <meta name="go-import" content="kubevirt.io/containerized-data-importer git https://github.com/kubevirt/containerized-data-importer">
    <meta name="go-import" content="kubevirt.io/hostpath-provisioner git https://github.com/kubevirt/hostpath-provisioner">
    <meta name="go-import" content="kubevirt.io/hostpath-provisioner-operator git https://github.com/kubevirt/hostpath-provisioner-operator">
    <meta name="go-import" content="kubevirt.io/qe-tools git https://github.com/kubevirt/qe-tools">
    <meta name="go-import" content="kubevirt.io/machine-remediation git https://github.com/kubevirt/machine-remediation">
    <meta name="go-import" content="kubevirt.io/cloud-provider-kubevirt git https://github.com/kubevirt/cloud-provider-kubevirt">
    <meta name="go-import" content="kubevirt.io/controller-lifecycle-operator-sdk git https://github.com/kubevirt/controller-lifecycle-operator-sdk">
    <meta name="go-import" content="kubevirt.io/ssp-operator git https://github.com/kubevirt/ssp-operator">
    <meta name="go-import" content="kubevirt.io/cpu-nfd-plugin git https://github.com/kubevirt/cpu-nfd-plugin">
    <meta name="go-import" content="kubevirt.io/containerized-data-importer-api git https://github.com/kubevirt/containerized-data-importer-api">
    <meta name="go-import" content="kubevirt.io/api git https://github.com/kubevirt/api">
    <meta name="go-import" content="kubevirt.io/node-maintenance-operator git https://github.com/kubevirt/node-maintenance-operator">
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png">
    <link rel="manifest" href="/assets/favicon/site.webmanifest">
    <link rel="mask-icon" href="/assets/favicon/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#00aba9">
    <meta name="theme-color" content="#ffffff">
    <meta name="google-site-verification" content="eaETLLM6xObn1li9l9eU8lNIBgBpU0OQLXV1faU1svE" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="https://kubevirt.io//2019/Hyper-Converged-Operator.html">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet">
    
    <title>Hyper Converged Operator | KubeVirt.io</title>
    <!-- # Opengraph protocol properties: https://ogp.me/ -->
    <meta name="author" content="DirectedSoul" >
    <meta property="og:type" content="article" >
    <meta name="twitter:card" content="summary">
    <meta name="description" content="Hyper Converged Operator on OCP 4 and K8s(HCO)">
    <meta name="keywords" content="HCO, hyperconverged operator" >
    <meta property="og:title" content="Hyper Converged Operator | KubeVirt.io">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://kubevirt.io//2019/Hyper-Converged-Operator.html" >
    <meta property="og:image" content="https://kubevirt.io//assets/images/KubeVirt_logo_color.png">
    <meta property="og:description" content="Hyper Converged Operator on OCP 4 and K8s(HCO)" >
    <meta property="og:site_name" content="KubeVirt.io" >
    <meta property="og:article:author" content="DirectedSoul" >
    <meta property="og:article:published_time" content="2019-04-17 00:00:00 +0000" >
    <meta name="twitter:title" content="Hyper Converged Operator | KubeVirt.io">
    <meta name="twitter:description" content="Hyper Converged Operator on OCP 4 and K8s(HCO)">

    <link type="application/atom+xml" rel="alternate" href="https://kubevirt.io//feed.xml" title="KubeVirt.io" />
    <script src="//code.jquery.com/jquery.min.js"></script>
    
    <!-- Photoswipe.com gallery-->

    <!-- Core CSS file -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/photoswipe.min.css">

    <!-- Skin CSS file (styling of UI - buttons, caption, etc.)
        In the folder of skin CSS file there are also:
        - .png and .svg icons sprite,
        - preloader.gif (for browsers that do not support CSS animations) -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/default-skin/default-skin.min.css">
</head>


  <body>
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top" role="navigation">
        <a class="navbar-brand" href="/">
    <img src="/assets/images/KubeVirt_logo_color.svg" class="navbar-brand-image d-inline-block align-top" alt="KubeVirt.io">
  </a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <i class="fas fa-th-large"></i>
  </button>
  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav">
      

      
        <li  class="nav-item active" >
          <a class="nav-link text-uppercase" href="/blogs/">Blogs</a>
        </li>
      
        <li  class="nav-item" >
          <a class="nav-link text-uppercase" href="/videos/">Videos</a>
        </li>
      
        <li  class="nav-item" >
          <a class="nav-link text-uppercase" href="/gallery/">Gallery</a>
        </li>
      
        <li  class="nav-item" >
          <a class="nav-link text-uppercase" href="//kubevirt.io/user-guide">Docs</a>
        </li>
      
        <li  class="nav-item" >
          <a class="nav-link text-uppercase" href="/labs/">Labs</a>
        </li>
      
        <li  class="nav-item" >
          <a class="nav-link text-uppercase" href="/community/">Community</a>
        </li>
      

      <li class='nav-item'>
        <form action="/search.html" class="nav-item__search" method="get" autocomplete="off">
          <div class="autocomplete" style="width:150px;">
            <input type="text" id="search-input" class="docs-search--input" placeholder="search term" name="query">
          </div>
          <input id="search-button" type="submit" value="🔍" disabled='true'>
        </form>
      </li>

    </ul>
  </div>
<script>
function autocomplete(inp, arr) {
  /*the autocomplete function takes two arguments,
  the text field element and an array of possible autocompleted values:*/
  var currentFocus;
  /*execute a function when someone writes in the text field:*/
  inp.addEventListener("input", function(e) {
      var a, b, i, val = this.value;
      /*close any already open lists of autocompleted values*/
      closeAllLists();
      if (!val) { return false;}
      currentFocus = -1;
      /*create a DIV element that will contain the items (values):*/
      a = document.createElement("DIV");
      a.setAttribute("id", this.id + "autocomplete-list");
      a.setAttribute("class", "autocomplete-items");
      /*append the DIV element as a child of the autocomplete container:*/
      this.parentNode.appendChild(a);
      /*for each item in the array...*/
      for (i = 0; i < arr.length; i++) {
        /*check if the item starts with the same letters as the text field value:*/
        if (arr[i].substr(0, val.length).toUpperCase() == val.toUpperCase()) {
          /*create a DIV element for each matching element:*/
          b = document.createElement("DIV");
          /*make the matching letters bold:*/
          b.innerHTML = "<strong>" + arr[i].substr(0, val.length) + "</strong>";
          b.innerHTML += arr[i].substr(val.length);
          /*insert a input field that will hold the current array item's value:*/
          b.innerHTML += "<input type='hidden' value='" + arr[i] + "'>";
          /*execute a function when someone clicks on the item value (DIV element):*/
              b.addEventListener("click", function(e) {
              /*insert the value for the autocomplete text field:*/
              inp.value = this.getElementsByTagName("input")[0].value;
              /*close the list of autocompleted values,
              (or any other open lists of autocompleted values:*/
              closeAllLists();
          });
          a.appendChild(b);
        }
      }
  });
  /*execute a function presses a key on the keyboard:*/
  inp.addEventListener("keydown", function(e) {
      document.getElementById("search-button").disabled= undefined;
      var x = document.getElementById(this.id + "autocomplete-list");
      if (x) x = x.getElementsByTagName("div");
      if (e.keyCode == 40) {
        /*If the arrow DOWN key is pressed,
        increase the currentFocus variable:*/
        currentFocus++;
        /*and and make the current item more visible:*/
        addActive(x);
      } else if (e.keyCode == 38) { //up
        /*If the arrow UP key is pressed,
        decrease the currentFocus variable:*/
        currentFocus--;
        /*and and make the current item more visible:*/
        addActive(x);
      } else if (e.keyCode == 13) {
        /*If the ENTER key is pressed, prevent the form from being submitted,*/
        if (currentFocus > -1) {
          /*and simulate a click on the "active" item:*/
          if (x) {
            x[currentFocus].click();
            e.preventDefault();
          }
        }
        if (document.getElementById("search-input").value == "") {
          e.preventDefault();
        }
      }
  });
  function addActive(x) {
    /*a function to classify an item as "active":*/
    if (!x) return false;
    /*start by removing the "active" class on all items:*/
    removeActive(x);
    if (currentFocus >= x.length) currentFocus = 0;
    if (currentFocus < 0) currentFocus = (x.length - 1);
    /*add class "autocomplete-active":*/
    x[currentFocus].classList.add("autocomplete-active");
  }
  function removeActive(x) {
    /*a function to remove the "active" class from all autocomplete items:*/
    for (var i = 0; i < x.length; i++) {
      x[i].classList.remove("autocomplete-active");
    }
  }
  function closeAllLists(elmnt) {
    /*close all autocomplete lists in the document,
    except the one passed as an argument:*/
    var x = document.getElementsByClassName("autocomplete-items");
    for (var i = 0; i < x.length; i++) {
      if (elmnt != x[i] && elmnt != inp) {
      x[i].parentNode.removeChild(x[i]);
    }
  }
}
/*execute a function when someone clicks in the document:*/
document.addEventListener("click", function (e) {
    closeAllLists(e.target);
});
}
</script>

<script>
var mykeywords = ["libvirt", "KubeVirt", "ClearContainers", "virtlet", "CRI", "OpenStack", "ovirt", "release notes", "changelog", "hilights", "network", "flannel", "kubevirt-ansible", "Skydive", "openshift", "glusterfs", "heketi", "virtual machine", "weavenet", "custom resources", "kubevirt objects", "objects", "VirtualMachine", "api", "rbac", "roles", "storage", "ovn", "kubetron", "neutron", "vscode", "development", "debug", "istio", "iptables", "tproxy", "service mesh", "ebtables", "docker", "container", "build", "multus", "roadmap", "kvm", "qemu", "device plugins", "unit testing", "review", "hugepages", "kubevirtci", "ci-cd", "cicd", "memory", "overcommitment", "networking", "CNI", "multiple networks", "ovs-cni", "import", "clone", "upload", "disk image", "cdi", "datavolumes", "volume types", "serviceaccount", "ignition", "coreos", "rhcos", "kubecon", "conference", "gcp", "autodeployer", "metrics", "prometheus", "grafana", "federation", "kubefed", "multicluster", "HCO", "hyperconverged operator", "ansible", "vagrant", "lifecycle", "virtual machines", "website", "community", "vm import", "node drain", "eviction", "nmo", "condition types", "Condition types", "CNCF", "sandbox", "lab", "cri-o", "quickstart", "homelab", "kubernetes", "kubevirt installation", "rook", "ceph", "ntp", "chronyd", "prow", "infrastructure", "kubevirt-tutorial", "CI-CD", "continuous integration", "jenkins", "noVNC", "console", "KubeCon", "cloudnativecon", "America", "talk", "gathering", "contra-lib", "admin", "operations", "create vm", "start vm", "connect to console", "connect to ssh", "stop vm", "remove vm", "operator manual", "basic operations", "laboratory", "installing kubevirt", "use kubevirt", "admin operations", "CDI", "containerized data importer", "octant", "okd", "openshift console", "cockpit", "user interface", "web interface", "virtVNC", "OKD console", "kubevirt upgrade", "upgrading", "OpenShift web console", "OKD", "video", "virtual machine management", "NUMA", "CPU pinning", "QEMU", "KVM", "GPU", "NVIDIA", "GPU workloads", "pass-through", "passthrough", "kubevirt", "Microsoft Windows kubernetes", "Microsoft Windows container", "Windows", "VM", "Advanced VM scheduling", "affinity", "scheduling", "topologyKeys", "Live Migration", "design", "architecture", "security", "operation", "images", "Kubernetes", "windows", "common-templates", "minikube", "addons", "oVirt", "kubevirt-hyperconverged", "cnao", "cluster-network-addons-operator", "kubernetes-nmstate", "nmstate", "bridge", "containerDisk", "registry", "composer-cli", "virt-customize", "builder tool", "prometheus-operator", "node-exporter", "monitoring", "event", "Tekton Pipelines", "KubeVirt Tekton Tasks", "vGPU", "Intel", "Fedora", "go", "authentication", "mesh", "AWS", "EC2", "AMI", "real-time", "CPUManager", "live migration", "dedicated network", "Kubevirt", "load-balancer", "MetalLB", "instancetypes", "preferences", "VirtualMachineInstancetype", "VirtualMachinePreference", ]
autocomplete(document.getElementById("search-input"), mykeywords);
</script>

<script src="/js/clipboard.min.js"></script>

    </nav>

    <main role="main" style="margin-top: 60px;">
      <div class="container">
  <div class="row">
    <div class="col">
      <div class="post">
        <header class="post-header">
          <h1></h1>
          <h1 class="post-title">Hyper Converged Operator</h1>
          <div class="post-info">
            <span class="post-author">Author: DirectedSoul</span>
            <div>
              <span class="post-category-name">
                Tags: <a href="/tag/hco">HCO</a>&nbsp;|&nbsp;<a href="/tag/hyperconverged-operator">hyperconverged operator</a>
              </span>
            </div>
            <div>
              <span class="post-meta">Publication Date: April 17, 2019  </span>
            </div>
            <div>
              <span class="post-category-name">
                Category: news
              </span>
            </div>

          </div>
        </header>
        <article class="post-content">
          <h1 id="hco-known-as-hyper-converged-operator"><a href="https://github.com/kubevirt/hyperconverged-cluster-operator">HCO known as Hyper Converged Operator</a></h1>

<p><strong>Prerequisites:</strong></p>

<p>This Blog assumes that the reader is aware of the concept of Operators and how it works in K8’s environment. Before proceeding further, feel free to take a look at this concept using <a href="https://coreos.com/blog/introducing-operators.html">CoreOS BlogPost</a></p>

<h2 id="what-it-does">What it does?</h2>

<p>The goal of the hyperconverged-cluster-operator (HCO) is to provide a single entrypoint for multiple operators - <a href="https://blog.openshift.com/a-first-look-at-kubevirt/">kubevirt</a>, <a href="http://kubevirt.io/2018/CDI-DataVolumes.html">cdi</a>, <a href="https://github.com/kubevirt/cluster-network-addons-operator/blob/main/README.md">networking</a>, etc… - where users can deploy and configure them in a single object. This operator is sometimes referred to as a “meta operator” or an “operator for operators”. Most importantly, this operator doesn’t replace or interfere with OLM. It only creates operator CRs, which is the user’s prerogative.</p>

<h2 id="how-does-it-work">How does it work?</h2>

<p>In this blog post, I’d like to focus on the first method(i.e by deploying a HCO using a CustomResourceDefinition method)which might seem like the most immediate benefit of this feature. Let’s get started!</p>

<h3 id="environment-description">Environment description</h3>

<p>We can use HCO both on <code class="language-plaintext highlighter-rouge">minikube</code> and also on <code class="language-plaintext highlighter-rouge">OpenShift 4</code>. We will be using OpenShift 4 for HCO in this post.</p>

<p><strong>Note</strong>: All the commands for installing HCO on minikube will remain the same as documented below, please follow the link <a href="/quickstart_minikube/">Install_HCO_minikube</a> install minikube by adjusting the memory to your requirement(atleast 4GiB of RAM is recommended).</p>

<h2 id="deploying-hco-on-openshift-4-cluster">Deploying HCO on OpenShift 4 Cluster.</h2>

<p><a href="https://www.openshift.com/learn/what-is-openshift/">OpenShift</a></p>

<p>Installation steps for OpenShift 4 including video tutorial can be found <a href="https://blog.openshift.com/installing-openshift-4-from-start-to-finish/">here</a></p>

<p>Upon successful installation of OpenShift, we will have a cluster consisting of 3 masters and 3 workers which can be used for HCO integration</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$oc</span> version
Client Version: version.Info<span class="o">{</span>Major:<span class="s2">"4"</span>, Minor:<span class="s2">"1+"</span>, GitVersion:<span class="s2">"v4.1.0"</span>, GitCommit:<span class="s2">"2793c3316"</span>, GitTreeState:<span class="s2">""</span>, BuildDate:<span class="s2">"2019-04-23T07:46:06Z"</span>, GoVersion:<span class="s2">""</span>, Compiler:<span class="s2">""</span>, Platform:<span class="s2">""</span><span class="o">}</span>
Server Version: version.Info<span class="o">{</span>Major:<span class="s2">"1"</span>, Minor:<span class="s2">"12+"</span>, GitVersion:<span class="s2">"v1.12.4+0ba401e"</span>, GitCommit:<span class="s2">"0ba401e"</span>, GitTreeState:<span class="s2">"clean"</span>, BuildDate:<span class="s2">"2019-03-31T22:28:12Z"</span>, GoVersion:<span class="s2">"go1.10.8"</span>, Compiler:<span class="s2">"gc"</span>, Platform:<span class="s2">"linux/amd64"</span><span class="o">}</span>
</code></pre></div></div>

<p>Check the nodes:</p>

<pre><code class="language-sg">$oc get nodes
NAME STATUS ROLES AGE VERSION
ip-10-0-133-213.us-east-2.compute.internal Ready worker 12m v1.13.4+da48e8391
ip-10-0-138-120.us-east-2.compute.internal Ready master 18m v1.13.4+da48e8391
ip-10-0-146-51.us-east-2.compute.internal Ready master 18m v1.13.4+da48e8391
ip-10-0-150-215.us-east-2.compute.internal Ready worker 12m v1.13.4+da48e8391
ip-10-0-160-201.us-east-2.compute.internal Ready master 17m v1.13.4+da48e8391
ip-10-0-168-28.us-east-2.compute.internal Ready worker 12m v1.13.4+da48e8391
</code></pre>

<p>Clone the <a href="https://github.com/kubevirt/hyperconverged-cluster-operator.git">HCO repo</a>:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/kubevirt/hyperconverged-cluster-operator.git
</code></pre></div></div>

<p>This gives all the necessary go packages and yaml manifests for the next steps.</p>

<p>Let’s create a NameSpace for the HCO deployment</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>oc create new-project kubevirt-hyperconverged
</code></pre></div></div>

<p>Now switch to the kubevirt-hyperconverged NameSpace</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>oc project kubevirt-hyperconverged
</code></pre></div></div>

<p>Now launch all the CRD’s</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>oc create <span class="nt">-f</span> deploy/converged/crds/hco.crd.yaml
oc create <span class="nt">-f</span> deploy/converged/crds/kubevirt.crd.yaml
oc create <span class="nt">-f</span> deploy/converged/crds/cdi.crd.yaml
oc create <span class="nt">-f</span> deploy/converged/crds/cna.crd.yaml
</code></pre></div></div>

<p>Let’s see the yaml file for HCO Custom Resource Definition</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apiextensions.k8s.io/v1beta1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">CustomResourceDefinition</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">hyperconvergeds.hco.kubevirt.io</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">additionalPrinterColumns</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">JSONPath</span><span class="pi">:</span> <span class="s">.metadata.creationTimestamp</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">Age</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">date</span>
    <span class="pi">-</span> <span class="na">JSONPath</span><span class="pi">:</span> <span class="s">.status.phase</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">Phase</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
  <span class="na">group</span><span class="pi">:</span> <span class="s">hco.kubevirt.io</span>
  <span class="na">names</span><span class="pi">:</span>
    <span class="na">kind</span><span class="pi">:</span> <span class="s">HyperConverged</span>
    <span class="na">plural</span><span class="pi">:</span> <span class="s">hyperconvergeds</span>
    <span class="na">shortNames</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">hco</span>
      <span class="pi">-</span> <span class="s">hcos</span>
    <span class="na">singular</span><span class="pi">:</span> <span class="s">hyperconverged</span>
  <span class="na">scope</span><span class="pi">:</span> <span class="s">Namespaced</span>
  <span class="na">subresources</span><span class="pi">:</span>
    <span class="na">status</span><span class="pi">:</span> <span class="pi">{}</span>
  <span class="na">version</span><span class="pi">:</span> <span class="s">v1alpha1</span>
  <span class="na">versions</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">v1alpha1</span>
      <span class="na">served</span><span class="pi">:</span> <span class="no">true</span>
      <span class="na">storage</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div></div>

<p>Let’s create ClusterRoleBindings, ClusterRole, ServerAccounts and Deployments for the operator</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>oc create <span class="nt">-f</span> deploy/converged
</code></pre></div></div>

<p>And after verifying all the above resources we can now finally deploy our HCO custom resource</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>oc create <span class="nt">-f</span> deploy/converged/crds/hco.cr.yaml
</code></pre></div></div>

<p>We can take a look at the YAML definition of the CustomResource of HCO:</p>

<p>Let’s create ClusterRoleBindings, ClusterRole, ServerAccounts and Deployments for the operator</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>oc create <span class="nt">-f</span> deploy/converged
</code></pre></div></div>

<p>And after verifying all the above resources we can now finally deploy our HCO custom resource</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>oc create <span class="nt">-f</span> deploy/converged/crds/hco.cr.yaml
</code></pre></div></div>

<p>We can take a look at the YAML definition of the CustomResource of HCO:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">hco.kubevirt.io/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">HyperConverged</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">hyperconverged-cluster</span>
</code></pre></div></div>

<p>After successfully executing the above commands,we should be now be having a virt-controller pod, HCO pod, and a network-addon pod functional and can be viewed as below.</p>

<p>Let’s see the deployed pods:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$oc</span> get pods
NAME                                               READY   STATUS    RESTARTS   AGE
cdi-apiserver-769fcc7bdf-rv8zt                     1/1     Running   0          5m2s
cdi-deployment-8b64c5585-g7zfk                     1/1     Running   0          5m2s
cdi-operator-c77447cc7-58ld2                       1/1     Running   0          11m
cdi-uploadproxy-8dcdcbff-rddl6                     1/1     Running   0          5m2s
cluster-network-addons-operator-85cd468ff5-xjgds   1/1     Running   0          11m
hyperconverged-cluster-operator-75dd9c96f9-pqvdk   1/1     Running   0          11m
virt-api-7f5bfb4c58-bkbhq                          1/1     Running   0          4m59s
virt-api-7f5bfb4c58-kkvwc                          1/1     Running   1          4m59s
virt-controller-6ccbfb7d5b-m7ljf                   1/1     Running   0          3m49s
virt-controller-6ccbfb7d5b-mbvlv                   1/1     Running   0          3m49s
virt-handler-hqz9d                                 1/1     Running   0          3m49s
virt-operator-667b6c845d-jfnsr                     1/1     Running   0          11m
</code></pre></div></div>

<p>Also the below deployments:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$oc</span> get deployments
NAME                              READY   UP-TO-DATE   AVAILABLE   AGE
cdi-apiserver                     1/1     1            1           10m
cdi-deployment                    1/1     1            1           10m
cdi-operator                      1/1     1            1           16m
cdi-uploadproxy                   1/1     1            1           10m
cluster-network-addons-operator   1/1     1            1           16m
hyperconverged-cluster-operator   1/1     1            1           16m
virt-api                          2/2     2            2           9m58s
virt-controller                   2/2     2            2           8m49s
virt-operator                     1/1     1            1           16m
</code></pre></div></div>

<div class="premonition note"><div class="fa fa-check-square"></div><div class="content"><p class="header">Note</p><p>Here, Once we applied the Custom Resource the operator took care of deploying the actual KubeVirt pods (virt-api, virt-controller and virt-handler), CDI pods(cdi-upload-proxy, cdi-apiserver, cdi-deployment, cdi-operator) and Network add-on pods ( cluster-network-addons-operator).We will need to wait until all of the resources are up and running. This can be done using the command above or by using the command above with the <code class="language-plaintext highlighter-rouge">-w</code>flag.</p>


</div></div>
<p>After the HCO is up and running on the cluster, we should be able to see the info of CRD’s</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$oc get crds | grep kubevirt
cdiconfigs.cdi.kubevirt.io                                       2019-05-07T20:22:17Z
cdis.cdi.kubevirt.io                                             2019-05-07T20:20:58Z
datavolumes.cdi.kubevirt.io                                      2019-05-07T20:22:17Z
hyperconvergeds.hco.kubevirt.io                                  2019-05-07T20:20:58Z
kubevirtcommontemplatesbundles.kubevirt.io                       2019-05-07T20:20:58Z
kubevirtnodelabellerbundles.kubevirt.io                          2019-05-07T20:20:58Z
kubevirts.kubevirt.io                                            2019-05-07T20:20:58Z
kubevirttemplatevalidators.kubevirt.io                           2019-05-07T20:20:58Z
kwebuis.kubevirt.io                                              2019-05-07T20:20:58Z
networkaddonsconfigs.networkaddonsoperator.network.kubevirt.io   2019-05-07T20:20:58Z
nodemaintenances.kubevirt.io                                     2019-05-07T20:20:58Z
virtualmachineinstancemigrations.kubevirt.io                     2019-05-07T20:23:02Z
virtualmachineinstancepresets.kubevirt.io                        2019-05-07T20:23:01Z
virtualmachineinstancereplicasets.kubevirt.io                    2019-05-07T20:23:02Z
virtualmachineinstances.kubevirt.io                              2019-05-07T20:23:01Z
virtualmachines.kubevirt.io                                      2019-05-07T20:23:02Z
</code></pre></div></div>

<div class="premonition note"><div class="fa fa-check-square"></div><div class="content"><p class="header">Note</p><p>In OpenShift we can use both <code class="language-plaintext highlighter-rouge">kubectl</code> and <code class="language-plaintext highlighter-rouge">oc</code> interchangeably to interact with the cluster objects once HCO is up and running.</p>


</div></div>
<h2 id="you-can-also-read-more-about-cdi-cna-ssp-operator-web-ui-and-kubevirt">You can also read more about CDI, CNA, ssp-operator, web-ui and KubeVirt:</h2>

<ul>
  <li><a href="/2018/CDI-DataVolumes.html">CDI</a></li>
  <li><a href="https://github.com/kubevirt/cluster-network-addons-operator/blob/main/README.md">CNA</a></li>
  <li><a href="/quickstart_minikube/">KubeVirt</a></li>
  <li><a href="https://github.com/MarSik/kubevirt-ssp-operator">ssp-operator</a></li>
  <li><a href="https://github.com/kubevirt/web-ui">kubevirt-web-ui</a></li>
  <li><a href="https://github.com/kubevirt/node-maintenance-operator">NodeMaintenance</a></li>
</ul>

<h1 id="hco-using-the-olm-method"><a href="https://github.com/operator-framework/operator-lifecycle-manager/blob/954a669200e57c6ce3105ddca17793186b3a3a43/Documentation/design/architecture.md">HCO using the OLM method</a></h1>

<div class="premonition note"><div class="fa fa-check-square"></div><div class="content"><p class="header">Note</p><p>The complete architecture of OLM and its components that connect together can be understood using the link <a href="https://github.com/operator-framework/operator-lifecycle-manager/blob/954a669200e57c6ce3105ddca17793186b3a3a43/Documentation/design/architecture.md">OLM_architecture</a></p>


</div></div>
<p>Replace <docker_org> with your Docker organization as official operator-registry images for HCO will not be provided.</docker_org></p>

<p>Next, build and publish the converged HCO operator-registry image.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>deploy/converged
<span class="nb">export </span><span class="nv">HCO_DOCKER_ORG</span><span class="o">=</span>&lt;docker_org&gt;
docker build <span class="nt">--no-cache</span> <span class="nt">-t</span> docker.io/<span class="nv">$HCO_DOCKER_ORG</span>/hco-registry:example <span class="nt">-f</span> Dockerfile <span class="nb">.</span>
docker push docker.io/<span class="nv">$HCO_DOCKER_ORG</span>/hco-registry:example
</code></pre></div></div>

<p>As an example deployment, Let’s take the value of operator-registry image as</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker.io/rthallisey/hyperconverged-cluster-operator:latest
</code></pre></div></div>

<p>Now, Let’s create the <code class="language-plaintext highlighter-rouge">kubevirt-hyperconverged</code> NS as below</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>oc create ns kubevirt-hyperconverged
</code></pre></div></div>

<p>Create the OperatorGroup</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">cat &lt;&lt;EOF | oc create -f -</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">operators.coreos.com/v1alpha2</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">OperatorGroup</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">hco-operatorgroup</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">kubevirt-hyperconverged</span>
<span class="s">EOF</span>
</code></pre></div></div>

<p>Create a Catalog Source backed by a grpc registry</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">cat &lt;&lt;EOF | oc create -f -</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">operators.coreos.com/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">CatalogSource</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">hco-catalogsource</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">openshift-operator-lifecycle-manager</span>
  <span class="na">imagePullPolicy</span><span class="pi">:</span> <span class="s">Always</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">sourceType</span><span class="pi">:</span> <span class="s">grpc</span>
  <span class="na">image</span><span class="pi">:</span> <span class="s">docker.io/rthallisey/hco-registry:v0.1-8</span>
  <span class="na">displayName</span><span class="pi">:</span> <span class="s">KubeVirt HyperConverged</span>
  <span class="na">publisher</span><span class="pi">:</span> <span class="s">Red Hat</span>
<span class="s">EOF</span>
</code></pre></div></div>

<p>Please wait until the <code class="language-plaintext highlighter-rouge">hco-catalogsource</code> pod comes up</p>

<p>Next is to create a subscription, we can create a subscription from the OpenShift4 web interface as shown below:</p>

<p><img src="../assets/2019-04-17-HyperConvergedOperator/subscription.png" alt="Subscription" /></p>

<p>Once subscribed, we can create a kubevirt Hyperconverged Operator from UI:</p>

<p><img src="../assets/2019-04-17-HyperConvergedOperator/kubevirt-hyperconverged-31.png" alt="Creating-Subscription" /></p>

<p>Install the HCO Operator:</p>

<p><img src="../assets/2019-04-17-HyperConvergedOperator/kubevirt-operator-57.png" alt="Installed-HCO" /></p>

<p>Please wait until the <code class="language-plaintext highlighter-rouge">virt-operator</code>, <code class="language-plaintext highlighter-rouge">cdi-operator</code> and <code class="language-plaintext highlighter-rouge">cluster-network-addons-operator</code> comes up.</p>

<p>After they are up, its now time to launch the HCO-Custom Resource itself:</p>

<p><img src="../assets/2019-04-17-HyperConvergedOperator/Installed-operator-HCO-48.png" alt="HCO-CR" /></p>

<p>Once the HCO Operator is deployed in the <code class="language-plaintext highlighter-rouge">kubevirt-hyperconverged</code> NS, we can see all the pods are up and running:</p>

<p><img src="../assets/2019-04-17-HyperConvergedOperator/status-pods-54.png" alt="HCO-Managed-Operators" /></p>

<p>We can verify the same from the CLI:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>oc get pods <span class="nt">-n</span> kubevirt-hyperconverged
NAME                                               READY   STATUS    RESTARTS   AGE
cdi-apiserver-769fcc7bdf-b5v8n                     1/1     Running   0          4m5s
cdi-deployment-8b64c5585-qs527                     1/1     Running   0          4m4s
cdi-operator-77b8847b96-5kmb2                      1/1     Running   0          4m55s
cdi-uploadproxy-8dcdcbff-xgnxf                     1/1     Running   0          4m5s
cluster-network-addons-operator-584dff99b8-c5kz5   1/1     Running   0          4m55s
hco-operator-59b559bd44-lgdnm                      1/1     Running   0          4m55s
kubevirt-ssp-operator-67b78446f7-l7rfv             1/1     Running   0          4m55s
kubevirt-web-ui-operator-9df6b67d9-mzf6s           1/1     Running   0          4m55s
node-maintenance-operator-6b464dc85-v6vmw          1/1     Running   0          4m55s
virt-api-7b56d7dd89-8s78r                          1/1     Running   0          2m59s
virt-api-7b56d7dd89-h75t8                          1/1     Running   1          2m59s
virt-controller-77c6d6d779-9qpp4                   1/1     Running   0          2m32s
virt-controller-77c6d6d779-vbbxg                   1/1     Running   0          2m32s
virt-handler-4bfb9                                 1/1     Running   0          2m32s
virt-handler-ns97x                                 1/1     Running   0          2m32s
virt-handler-q7wbh                                 1/1     Running   0          2m32s
virt-operator-87d7c98b-mh8pg                       1/1     Running   0          4m55s
virt-operator-87d7c98b-p6mbd                       1/1     Running   0          4m55s
</code></pre></div></div>

<p>We can see how OLM operator manages the HCO pods from the <code class="language-plaintext highlighter-rouge">openshift-operator-lifecycle-manager</code> NS:</p>

<p><img src="../assets/2019-04-17-HyperConvergedOperator/HCO-Managed-Operators.png" alt="HCO-Managed-Operators" /></p>

<p>The above method demonstrates the integration of HCO operator in OpenShift4.</p>

<p>So, after HCO is up and running we need to test it by deploying a small instance of a VM.To deploy an instance follow the instructions here <a href="/quickstart_minikube/#virtctl">minikube_quickstart</a>:</p>

<h2 id="conclusion">Conclusion</h2>

<p>What to expect next?</p>

<p>HCO achieved its goal which was to provide a single entrypoint for multiple operators - kubevirt, cdi, networking, etc.where users can deploy and configure them in a single object as seen above.</p>

<p>Now, we can also launch the HCO through OLM.</p>

<div class="premonition note"><div class="fa fa-check-square"></div><div class="content"><p class="header">Note</p><p>Until we publish (and consume) the HCO and component operators through <a href="https://operatorhub.io/">operatorhub.io</a>, this is a means to demonstrate the HCO workflow without OLM
Once we publish operators through Marketplace at <a href="https://operatorhub.io">OperatorHub.io</a>, it will be available <a href="https://github.com/operator-framework/operator-lifecycle-manager/blob/954a669200e57c6ce3105ddca17793186b3a3a43/Documentation/install/install.md#installing-olm">here</a></p>


</div></div>

        </article>
        
        

<a class="twitter-share-button" href="https://twitter.com/intent/tweet?text=Hyper Converged Operator&url=https://www.kubevirt.io/2019/Hyper-Converged-Operator.html&screen_name=kubevirt" aria-label="Share this on Twitter">
  <i class="fab fa-twitter mr-1"></i> Tweet
</a>
<hr/>


      </div>
    </div>
  </div>
</div>
<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe.
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides.
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo https://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>
<script src="/js/photoswipe-page.js">
</script>

    </main>

    <footer class="footer" role="footer">
      <div class="container-fluid">
  <div class="row justify-content-between">
    <div class="col-sm-12 col-md-5">
      <p>We are a <a href="https://cncf.io/">Cloud Native Computing Foundation</a> sandbox project.</p>
      <p><a href="https://cncf.io/"><img src="/assets/images/cncf-color.png" alt="Cloud Native Computing Foundation"/></a></p>
    </div>
    <div class="col-sm-12 col-md-5" style="text-align: center;">
      <p class="text-md-right">

        <a href="https://twitter.com/kubevirt" data-toggle="tooltip" data-placement="top" title="Follow us on Twitter!" aria-label="Visit us on Twitter" class="link-social-twitter">
          <i class="fab fa-twitter fa-lg"></i>
        </a>

        <a href="https://kubernetes.slack.com/archives/C8ED7RKFE" data-toggle="tooltip" data-placement="top" title="Join our Slack channel!" class="link-social-slack">
          <i class="fab fa-slack fa-lg"></i>
        </a>

        <a href="https://github.com/kubevirt" data-toggle="tooltip" data-placement="top" title="Check our GitHub!" class="link-social-github">
          <i class="fab fa-github fa-lg"></i>
        </a>

        <a href="https://groups.google.com/forum/#!forum/kubevirt-dev" data-toggle="tooltip" data-placement="top" title="Join our mailing list!" class="link-social-mail">
          <i class="fas fa-envelope fa-lg"></i>
        </a>

        <a href="https://calendar.google.com/calendar/u/0/embed?src=kubevirt@cncf.io" data-toggle="tooltip" data-placement="top" title="See our events calendar!" class="link-social-calendar">
          <i class="fas fa-calendar fa-lg"></i>
        </a>

        <a href="https://www.youtube.com/channel/UC2FH36TbZizw25pVT1P3C3g/videos" data-toggle="tooltip" data-placement="top" title="Subscribe to our YouTube channel!" class="link-social-youtube">
          <i class="fab fa-youtube fa-lg"></i>
        </a>

      </p>
    </div>
  </div>
  <div class="row">
    <div class="col text-sm-left footer-licensing" style="text-align: center;">
      Copyright 2022 The KubeVirt Contributors<br>
      Copyright 2022 The Linux Foundation. All Rights Reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage">Trademark Usage</a> page.<br>
      This site is powered by <a href="https://www.netlify.com/legal/open-source-policy/">Netlify</a>.
      <p class="privacy-statement text-sm-left" style="text-align: center;">
        <a href="/privacy" class="privacy-statement-link">Privacy Statement</a>
      </p>
  </div>
</div>
<script src="/js/copy.js"></script>

    </footer>

    <script defer src="https://use.fontawesome.com/releases/v5.1.0/js/all.js" integrity="sha384-3LK/3kTpDE/Pkp8gTNp2gR/2gOiwQ6QaO7Td0zV76UFJVhqLl4Vl3KL1We6q6wR9" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>
    <script src="/js/kubevirt-io.js"></script>
    <!-- Photoswipe -->
    <!-- Core JS file -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/photoswipe.min.js"></script>
    <!-- UI JS file -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>

    <!-- This comes from DTM/DPAL and must be latest entry in body-->

    <script type="text/javascript">
        if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
            _satellite.pageBottom();
        }
    </script>
  </body>
</html>
