<!doctype html>
<html lang="en">

  <head>
    <!-- Adding Adobe Analytics -->
    <script id="dpal" src="//www.redhat.com/ma/dpal.js" type="text/javascript"></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1, shrink-to-fit=no" >
    <meta name="go-import" content="kubevirt.io/kubevirt git https://github.com/kubevirt/kubevirt">
    <meta name="go-import" content="kubevirt.io/client-go git https://github.com/kubevirt/client-go">
    <meta name="go-import" content="kubevirt.io/containerized-data-importer git https://github.com/kubevirt/containerized-data-importer">
    <meta name="go-import" content="kubevirt.io/managed-tenant-quota git https://github.com/kubevirt/managed-tenant-quota">
    <meta name="go-import" content="kubevirt.io/applications-aware-quota git https://github.com/kubevirt/applications-aware-quota">
    <meta name="go-import" content="kubevirt.io/application-aware-quota git https://github.com/kubevirt/application-aware-quota">
    <meta name="go-import" content="kubevirt.io/hostpath-provisioner git https://github.com/kubevirt/hostpath-provisioner">
    <meta name="go-import" content="kubevirt.io/hostpath-provisioner-operator git https://github.com/kubevirt/hostpath-provisioner-operator">
    <meta name="go-import" content="kubevirt.io/qe-tools git https://github.com/kubevirt/qe-tools">
    <meta name="go-import" content="kubevirt.io/machine-remediation git https://github.com/kubevirt/machine-remediation">
    <meta name="go-import" content="kubevirt.io/cloud-provider-kubevirt git https://github.com/kubevirt/cloud-provider-kubevirt">
    <meta name="go-import" content="kubevirt.io/controller-lifecycle-operator-sdk git https://github.com/kubevirt/controller-lifecycle-operator-sdk">
    <meta name="go-import" content="kubevirt.io/ssp-operator git https://github.com/kubevirt/ssp-operator">
    <meta name="go-import" content="kubevirt.io/vm-console-proxy git https://github.com/kubevirt/vm-console-proxy">
    <meta name="go-import" content="kubevirt.io/cpu-nfd-plugin git https://github.com/kubevirt/cpu-nfd-plugin">
    <meta name="go-import" content="kubevirt.io/containerized-data-importer-api git https://github.com/kubevirt/containerized-data-importer-api">
    <meta name="go-import" content="kubevirt.io/application-aware-quota-api git https://github.com/kubevirt/application-aware-quota-api">
    <meta name="go-import" content="kubevirt.io/api git https://github.com/kubevirt/api">
    <meta name="go-import" content="kubevirt.io/node-maintenance-operator git https://github.com/kubevirt/node-maintenance-operator">
    <meta name="go-import" content="kubevirt.io/containerdisks git https://github.com/kubevirt/containerdisks">
    <meta name="go-import" content="kubevirt.io/virt-template git https://github.com/kubevirt/virt-template">
    <meta name="go-import" content="kubevirt.io/virt-template-api git https://github.com/kubevirt/virt-template-api">
    <meta name="go-import" content="kubevirt.io/virt-template-client-go git https://github.com/kubevirt/virt-template-client-go">
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png">
    <link rel="manifest" href="/assets/favicon/site.webmanifest">
    <link rel="mask-icon" href="/assets/favicon/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#00aba9">
    <meta name="theme-color" content="#ffffff">
    <meta name="google-site-verification" content="ljFssJAOE7EegX8RSNhm2heZib4B2JPUwzoDLnIo0VM" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="https://kubevirt.io//2019/How-To-Import-VM-into-Kubevirt.html">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet">
    
    <title>How to import VM into KubeVirt | KubeVirt.io</title>
    <!-- # Opengraph protocol properties: https://ogp.me/ -->
    <meta name="author" content="DirectedSoul" >
    <meta property="og:type" content="article" >
    <meta name="twitter:card" content="summary">
    <meta name="description" content="Import a VM into the Kubernetes Platform using CDI">
    <meta name="keywords" content="cdi, vm import" >
    <meta property="og:title" content="How to import VM into KubeVirt | KubeVirt.io">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://kubevirt.io//2019/How-To-Import-VM-into-Kubevirt.html" >
    <meta property="og:image" content="https://kubevirt.io//assets/images/KubeVirt_logo_color.png">
    <meta property="og:description" content="Import a VM into the Kubernetes Platform using CDI" >
    <meta property="og:site_name" content="KubeVirt.io" >
    <meta property="og:article:author" content="DirectedSoul" >
    <meta property="og:article:published_time" content="2019-07-29 00:00:00 +0000" >
    <meta name="twitter:title" content="How to import VM into KubeVirt | KubeVirt.io">
    <meta name="twitter:description" content="Import a VM into the Kubernetes Platform using CDI">

    <link type="application/atom+xml" rel="alternate" href="https://kubevirt.io//feed.xml" title="KubeVirt.io" />
    <script src="//code.jquery.com/jquery.min.js"></script>
    
    <!-- Photoswipe.com gallery-->

    <!-- Core CSS file -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/photoswipe.min.css">

    <!-- Skin CSS file (styling of UI - buttons, caption, etc.)
        In the folder of skin CSS file there are also:
        - .png and .svg icons sprite,
        - preloader.gif (for browsers that do not support CSS animations) -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/default-skin/default-skin.min.css">
</head>


  <body>
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top" role="navigation">
        <a class="navbar-brand" href="/">
    <img src="/assets/images/KubeVirt_logo_color.svg" class="navbar-brand-image d-inline-block align-top" alt="KubeVirt.io">
  </a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <i class="fas fa-th-large"></i>
  </button>
  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav">
      

      
        <li  class="nav-item active" >
          <a class="nav-link text-uppercase" href="/blogs/">Blogs</a>
        </li>
      
        <li  class="nav-item" >
          <a class="nav-link text-uppercase" href="/videos/">Videos</a>
        </li>
      
        <li  class="nav-item" >
          <a class="nav-link text-uppercase" href="/gallery/">Gallery</a>
        </li>
      
        <li  class="nav-item" >
          <a class="nav-link text-uppercase" href="//kubevirt.io/user-guide">Docs</a>
        </li>
      
        <li  class="nav-item" >
          <a class="nav-link text-uppercase" href="/labs/">Labs</a>
        </li>
      
        <li  class="nav-item" >
          <a class="nav-link text-uppercase" href="/community/">Community</a>
        </li>
      

      <li class='nav-item'>
        <form action="/search.html" class="nav-item__search" method="get" autocomplete="off">
          <div class="autocomplete" style="width:150px;">
            <input type="text" id="search-input" class="docs-search--input" placeholder="search term" name="query">
          </div>
          <input id="search-button" type="submit" value="ðŸ”" disabled='true'>
        </form>
      </li>

    </ul>
  </div>
<script>
function autocomplete(inp, arr) {
  /*the autocomplete function takes two arguments,
  the text field element and an array of possible autocompleted values:*/
  var currentFocus;
  /*execute a function when someone writes in the text field:*/
  inp.addEventListener("input", function(e) {
      var a, b, i, val = this.value;
      /*close any already open lists of autocompleted values*/
      closeAllLists();
      if (!val) { return false;}
      currentFocus = -1;
      /*create a DIV element that will contain the items (values):*/
      a = document.createElement("DIV");
      a.setAttribute("id", this.id + "autocomplete-list");
      a.setAttribute("class", "autocomplete-items");
      /*append the DIV element as a child of the autocomplete container:*/
      this.parentNode.appendChild(a);
      /*for each item in the array...*/
      for (i = 0; i < arr.length; i++) {
        /*check if the item starts with the same letters as the text field value:*/
        if (arr[i].substr(0, val.length).toUpperCase() == val.toUpperCase()) {
          /*create a DIV element for each matching element:*/
          b = document.createElement("DIV");
          /*make the matching letters bold:*/
          b.innerHTML = "<strong>" + arr[i].substr(0, val.length) + "</strong>";
          b.innerHTML += arr[i].substr(val.length);
          /*insert a input field that will hold the current array item's value:*/
          b.innerHTML += "<input type='hidden' value='" + arr[i] + "'>";
          /*execute a function when someone clicks on the item value (DIV element):*/
              b.addEventListener("click", function(e) {
              /*insert the value for the autocomplete text field:*/
              inp.value = this.getElementsByTagName("input")[0].value;
              /*close the list of autocompleted values,
              (or any other open lists of autocompleted values:*/
              closeAllLists();
          });
          a.appendChild(b);
        }
      }
  });
  /*execute a function presses a key on the keyboard:*/
  inp.addEventListener("keydown", function(e) {
      document.getElementById("search-button").disabled= undefined;
      var x = document.getElementById(this.id + "autocomplete-list");
      if (x) x = x.getElementsByTagName("div");
      if (e.keyCode == 40) {
        /*If the arrow DOWN key is pressed,
        increase the currentFocus variable:*/
        currentFocus++;
        /*and and make the current item more visible:*/
        addActive(x);
      } else if (e.keyCode == 38) { //up
        /*If the arrow UP key is pressed,
        decrease the currentFocus variable:*/
        currentFocus--;
        /*and and make the current item more visible:*/
        addActive(x);
      } else if (e.keyCode == 13) {
        /*If the ENTER key is pressed, prevent the form from being submitted,*/
        if (currentFocus > -1) {
          /*and simulate a click on the "active" item:*/
          if (x) {
            x[currentFocus].click();
            e.preventDefault();
          }
        }
        if (document.getElementById("search-input").value == "") {
          e.preventDefault();
        }
      }
  });
  function addActive(x) {
    /*a function to classify an item as "active":*/
    if (!x) return false;
    /*start by removing the "active" class on all items:*/
    removeActive(x);
    if (currentFocus >= x.length) currentFocus = 0;
    if (currentFocus < 0) currentFocus = (x.length - 1);
    /*add class "autocomplete-active":*/
    x[currentFocus].classList.add("autocomplete-active");
  }
  function removeActive(x) {
    /*a function to remove the "active" class from all autocomplete items:*/
    for (var i = 0; i < x.length; i++) {
      x[i].classList.remove("autocomplete-active");
    }
  }
  function closeAllLists(elmnt) {
    /*close all autocomplete lists in the document,
    except the one passed as an argument:*/
    var x = document.getElementsByClassName("autocomplete-items");
    for (var i = 0; i < x.length; i++) {
      if (elmnt != x[i] && elmnt != inp) {
      x[i].parentNode.removeChild(x[i]);
    }
  }
}
/*execute a function when someone clicks in the document:*/
document.addEventListener("click", function (e) {
    closeAllLists(e.target);
});
}
</script>

<script>
var mykeywords = ["libvirt", "KubeVirt", "ClearContainers", "virtlet", "CRI", "OpenStack", "ovirt", "release notes", "changelog", "hilights", "network", "flannel", "kubevirt-ansible", "Skydive", "openshift", "glusterfs", "heketi", "virtual machine", "weavenet", "custom resources", "kubevirt objects", "objects", "VirtualMachine", "api", "rbac", "roles", "storage", "ovn", "kubetron", "neutron", "vscode", "development", "debug", "istio", "iptables", "tproxy", "service mesh", "ebtables", "docker", "container", "build", "multus", "roadmap", "kvm", "qemu", "device plugins", "unit testing", "review", "hugepages", "kubevirtci", "ci-cd", "cicd", "memory", "overcommitment", "networking", "CNI", "multiple networks", "ovs-cni", "import", "clone", "upload", "disk image", "cdi", "datavolumes", "volume types", "serviceaccount", "ignition", "coreos", "rhcos", "kubecon", "conference", "gcp", "autodeployer", "metrics", "prometheus", "grafana", "federation", "kubefed", "multicluster", "HCO", "hyperconverged operator", "ansible", "vagrant", "lifecycle", "virtual machines", "website", "community", "vm import", "node drain", "eviction", "nmo", "condition types", "Condition types", "CNCF", "sandbox", "lab", "cri-o", "quickstart", "homelab", "kubernetes", "kubevirt installation", "rook", "ceph", "ntp", "chronyd", "prow", "infrastructure", "kubevirt-tutorial", "CI-CD", "continuous integration", "jenkins", "KubeCon", "cloudnativecon", "America", "talk", "gathering", "contra-lib", "admin", "operations", "create vm", "start vm", "connect to console", "connect to ssh", "stop vm", "remove vm", "operator manual", "basic operations", "laboratory", "installing kubevirt", "use kubevirt", "admin operations", "CDI", "containerized data importer", "octant", "okd", "openshift console", "cockpit", "noVNC", "user interface", "web interface", "virtVNC", "OKD console", "kubevirt upgrade", "upgrading", "OpenShift web console", "OKD", "video", "virtual machine management", "NUMA", "CPU pinning", "QEMU", "KVM", "GPU", "NVIDIA", "GPU workloads", "pass-through", "passthrough", "kubevirt", "Microsoft Windows kubernetes", "Microsoft Windows container", "Windows", "VM", "Advanced VM scheduling", "affinity", "scheduling", "topologyKeys", "Live Migration", "design", "architecture", "security", "operation", "images", "Kubernetes", "windows", "common-templates", "minikube", "addons", "oVirt", "kubevirt-hyperconverged", "cnao", "cluster-network-addons-operator", "kubernetes-nmstate", "nmstate", "bridge", "containerDisk", "registry", "composer-cli", "virt-customize", "builder tool", "prometheus-operator", "node-exporter", "monitoring", "event", "Tekton Pipelines", "KubeVirt Tekton Tasks", "vGPU", "Intel", "Fedora", "go", "authentication", "mesh", "AWS", "EC2", "AMI", "real-time", "CPUManager", "live migration", "dedicated network", "Kubevirt", "load-balancer", "MetalLB", "instancetypes", "preferences", "VirtualMachineInstancetype", "VirtualMachinePreference", "SDN", "OVN", "v1.0", "release", "cncf", "milestone", "party time", "NetworkPolicy", "Ansible", "ansible collection", "kubevirt.core", "iac", "Cluster Autoscaler", "EKS", "v1.1.0", "v1.4", "VMIM", "migrate", "migrations", "RBAC", "hardening", "v1.5", "packer", "plugin", "evpn", "bgp", "openperouter", "live-migration", "graduation", ]
autocomplete(document.getElementById("search-input"), mykeywords);
</script>

<script src="/js/clipboard.min.js"></script>

    </nav>

    <main role="main" style="margin-top: 60px;">
      <div class="container">
  <div class="row">
    <div class="col">
      <div class="post">
        <header class="post-header">
          <h1></h1>
          <h1 class="post-title">How to import VM into KubeVirt</h1>
          <div class="post-info">
            <span class="post-author">Author: DirectedSoul</span>
            <div>
              <span class="post-category-name">
                Tags: <a href="/tag/cdi">cdi</a>&nbsp;|&nbsp;<a href="/tag/vm-import">vm import</a>
              </span>
            </div>
            <div>
              <span class="post-meta">Publication Date: July 29, 2019  </span>
            </div>
            <div>
              <span class="post-category-name">
                Category: news
              </span>
            </div>

          </div>
        </header>
        <article class="post-content">
          <h2 id="introduction">Introduction</h2>

<p>Kubernetes has become the new way to orchestrate the containers and to handle the microservices, but what if I already have applications running on my old VMâ€™s in my datacenter ? Can those apps ever be made k8s friendly ? Well, if that is the use-case for you, then we have a solution with KubeVirt!</p>

<p>In this blog post we will show you how to deploy a VM as a yaml template and the required steps on how to import it as a <a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/">PVC</a> onto your kubernetes environment using the CDI and KubeVirt add-ons.</p>

<p><strong>Assumptions:</strong></p>

<ul>
  <li>
    <p>A basic understanding of the k8s architecture: In its simplest terms Kubernetes is a portable, extensible open-source platform for managing containerized workloads and services, that facilitates both declarative configuration and automation. It has a large, rapidly growing ecosystem. Kubernetes services, support, and tools are widely available. For complete details check <a href="https://www.aquasec.com/wiki/display/containers/Kubernetes+Architecture+101">Kubernetes-architecture</a></p>
  </li>
  <li>
    <p>User is familiar with the concept of a <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/virtualization_deployment_and_administration_guide/sect-guest_virtual_machine_installation_overview-creating_guests_with_virt_install">Libvirt based VM</a></p>
  </li>
  <li>
    <p>PersistentVolume (PV) is a piece of storage in the cluster that has been provisioned by an administrator. Feel free to check more on <a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/">Persistent Volume(PV)</a>.</p>
  </li>
  <li>
    <p>Persistent Volume Claim (PVC) is a request for storage by a user. It is similar to a pod. Pods consume node resources and PVCs consume PV resources. Feel free to check more on <a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/#persistentvolumeclaims">Persistent Volume Claim(PVC)</a>.</p>
  </li>
  <li>
    <p>User is familiar with the concept of <a href="https://github.com/kubevirt/kubevirt/blob/main/docs/architecture.md">KubeVirt-architecture</a> and <a href="https://github.com/kubevirt/containerized-data-importer/blob/main/doc/design.md#design">CDI-architecture</a></p>
  </li>
  <li>
    <p>User has already installed KubeVirt in an available K8s environment, if not please follow the link <a href="https://kubevirt.io/user-guide/operations/installation/">Installing KubeVirt</a> to further proceed.</p>
  </li>
  <li>
    <p>User is already familiar with VM operation with Kubernetes, for a refresher on how to use â€˜Virtual Machinesâ€™ in Kubernetes, please do check <a href="/labs/kubernetes/lab1">LAB 1</a> before proceeding.</p>
  </li>
</ul>

<h2 id="creating-virtual-machines-from-local-images-with-cdi-and-virtctl">Creating Virtual Machines from local images with CDI and virtctl</h2>

<p>The <a href="https://github.com/kubevirt/containerized-data-importer">Containerized Data Importer (CDI)</a> project provides facilities for enabling Persistent Volume Claims (PVCs) to be used as disks for KubeVirt VMs. The three main CDI use cases are:</p>

<ul>
  <li>Import a disk image from a URL to a PVC (HTTP/S3)</li>
  <li>Clone an existing PVC</li>
  <li>Upload a local disk image to a PVC</li>
</ul>

<p>This document covers the third use case and covers the HTTP based import use case at the end of this post.</p>

<p><strong>NOTE</strong>: You should have CDI installed in your cluster, a VM disk that youâ€™d like to upload, and virtctl in your path</p>

<p>Please follow the instructions for the <a href="https://github.com/kubevirt/containerized-data-importer">installation of CDI</a> (v1.9.0 as of this writing)</p>

<p><strong>Expose cdi-uploadproxy service:</strong></p>

<p>The cdi-uploadproxy service must be accessible from outside the cluster. Here are some ways to do that:</p>

<ul>
  <li><a href="https://kubernetes.io/docs/concepts/services-networking/service/#nodeport">NodePort Service</a></li>
  <li><a href="https://kubernetes.io/docs/concepts/services-networking/ingress/">Ingress</a></li>
  <li><a href="https://docs.openshift.com/container-platform/3.9/architecture/networking/routes.html">Route</a></li>
</ul>

<p>We can take a look at example manifests <a href="https://github.com/kubevirt/containerized-data-importer/blob/main/doc/upload.md">here</a></p>

<p>The supported image formats are:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">.img</code></li>
  <li><code class="language-plaintext highlighter-rouge">.iso</code></li>
  <li><code class="language-plaintext highlighter-rouge">.qcow2</code></li>
  <li>Compressed (<code class="language-plaintext highlighter-rouge">.tar</code>, <code class="language-plaintext highlighter-rouge">.gz</code> or <code class="language-plaintext highlighter-rouge">.xz</code>) of the above formats.</li>
</ul>

<p>We will use <a href="http://download.cirros-cloud.net/0.4.0/cirros-0.4.0-x86_64-disk.img">this image</a> from <a href="https://launchpad.net/cirros">CirrOS Project</a> (in <code class="language-plaintext highlighter-rouge">.img</code> format)</p>

<p>We can use <code class="language-plaintext highlighter-rouge">virtctl</code> command for uploading the image as shown below:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>virtctl image-upload <span class="nt">--help</span>
Upload a VM image to a PersistentVolumeClaim.

Usage:
  virtctl image-upload <span class="o">[</span>flags]

Examples:
  <span class="c"># Upload a local disk image to a newly created PersistentVolumeClaim:</span>
    virtctl image-upload <span class="nt">--uploadproxy-url</span><span class="o">=</span>https://cdi-uploadproxy.mycluster.com <span class="nt">--pvc-name</span><span class="o">=</span>upload-pvc <span class="nt">--pvc-size</span><span class="o">=</span>10Gi <span class="nt">--image-path</span><span class="o">=</span>/images/fedora28.qcow2

Flags:
      <span class="nt">--access-mode</span> string       The access mode <span class="k">for </span>the PVC. <span class="o">(</span>default <span class="s2">"ReadWriteOnce"</span><span class="o">)</span>
  <span class="nt">-h</span>, <span class="nt">--help</span>                     <span class="nb">help </span><span class="k">for </span>image-upload
      <span class="nt">--image-path</span> string        Path to the <span class="nb">local </span>VM image.
      <span class="nt">--insecure</span>                 Allow insecure server connections when using HTTPS.
      <span class="nt">--no-create</span>                Don<span class="s1">'t attempt to create a new PVC.
      --pvc-name string          The destination PVC.
      --pvc-size string          The size of the PVC to create (ex. 10Gi, 500Mi).
      --storage-class string     The storage class for the PVC.
      --uploadproxy-url string   The URL of the cdi-upload proxy service.
      --wait-secs uint           Seconds to wait for upload pod to start. (default 60)

Use "virtctl options" for a list of global command-line options (applies to all commands).
</span></code></pre></div></div>

<h3 id="creation-of-virtualmachineinstance-from-a-pvc">Creation of VirtualMachineInstance from a PVC</h3>

<p>Here, <code class="language-plaintext highlighter-rouge">virtctl image-upload</code> works by creating a PVC of the requested size, sending an <code class="language-plaintext highlighter-rouge">UploadTokenRequest</code> to the <code class="language-plaintext highlighter-rouge">cdi-apiserver</code>, and uploading the file to the <code class="language-plaintext highlighter-rouge">cdi-uploadproxy</code>.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>virtctl image-upload <span class="nt">--pvc-name</span><span class="o">=</span>cirros-vm-disk <span class="nt">--pvc-size</span><span class="o">=</span>500Mi <span class="nt">--image-path</span><span class="o">=</span>/home/shegde/images/cirros-0.4.0-x86_64-disk.img <span class="nt">--uploadproxy-url</span><span class="o">=</span>&lt;url to upload proxy service&gt;
</code></pre></div></div>

<p>The data inside are ephemeral meaning is lost when the VM restarts, in order to prevent that, and provide a persistent data storage, we use PVC (<code class="language-plaintext highlighter-rouge">persistentVolumeClaim</code>) which allows connecting a PersistentVolumeClaim to a VM disk.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh"> | kubectl apply -f -
apiVersion: kubevirt.io/v1alpha3
kind: VirtualMachineInstance
metadata:
  name: cirros-vm
spec:
  domain:
    devices:
      disks:
      - disk:
          bus: virtio
        name: pvcdisk
    machine:
      type: ""
    resources:
      requests:
        memory: 64M
  terminationGracePeriodSeconds: 0
  volumes:
  - name: pvcdisk
    persistentVolumeClaim:
      claimName: cirros-vm-disk
status: {}
</span><span class="no">EOF
</span></code></pre></div></div>

<p>A <code class="language-plaintext highlighter-rouge">PersistentVolume</code> can be in <code class="language-plaintext highlighter-rouge">filesystem</code> or <code class="language-plaintext highlighter-rouge">block</code> mode:</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Filesystem</code>: For KubeVirt to be able to consume the disk present on a PersistentVolumeâ€™s filesystem, the disk must be named <code class="language-plaintext highlighter-rouge">disk.img</code> and be placed in the root path of the filesystem. Currently the disk is also required to be in <code class="language-plaintext highlighter-rouge">raw</code> format.</p>

    <p><strong>Important</strong>: The <code class="language-plaintext highlighter-rouge">disk.img</code> image file needs to be owned by the user-id <code class="language-plaintext highlighter-rouge">107</code> in order to avoid permission issues. Additionally, if the <code class="language-plaintext highlighter-rouge">disk.img</code> image file has not been created manually before starting a VM then it will be created automatically with the PersistentVolumeClaim size. Since not every storage provisioner provides volumes with the exact usable amount of space as requested (e.g. due to filesystem overhead), KubeVirt tolerates up to 10% less available space. This can be configured with the <code class="language-plaintext highlighter-rouge">pvc-tolerate-less-space-up-to-percent</code> value in the <code class="language-plaintext highlighter-rouge">kubevirt-config</code> ConfigMap.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Block</code>: Use a block volume for consuming raw block devices. To do that, <code class="language-plaintext highlighter-rouge">BlockVolume</code> feature gate must be enabled.</p>
  </li>
</ul>

<p>A simple example which attaches a PersistentVolumeClaim as a disk may look like this:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">testvmi-pvc</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">kubevirt.io/v1alpha3</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">VirtualMachineInstance</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">domain</span><span class="pi">:</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="na">requests</span><span class="pi">:</span>
        <span class="na">memory</span><span class="pi">:</span> <span class="s">64M</span>
    <span class="na">devices</span><span class="pi">:</span>
      <span class="na">disks</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">mypvcdisk</span>
          <span class="na">lun</span><span class="pi">:</span> <span class="pi">{}</span>
  <span class="na">volumes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">mypvcdisk</span>
      <span class="na">persistentVolumeClaim</span><span class="pi">:</span>
        <span class="na">claimName</span><span class="pi">:</span> <span class="s">mypvc</span>
</code></pre></div></div>

<h3 id="creation-with-a-datavolume">Creation with a DataVolume</h3>

<p>DataVolumes are a way to automate importing virtual machine disks onto pvcâ€™s during the virtual machineâ€™s launch flow. Without using a DataVolume, users have to prepare a pvc with a disk image before assigning it to a VM or VMI manifest. With a DataVolume, both the pvc creation and import is automated on behalf of the user.</p>

<h4 id="datavolume-vm-behavior">DataVolume VM Behavior</h4>

<p>DataVolumes can be defined in the VM spec directly by adding the DataVolumes to the dataVolumeTemplates list. Below is an example.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">kubevirt.io/v1alpha3</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">VirtualMachine</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">kubevirt.io/vm</span><span class="pi">:</span> <span class="s">vm-alpine-datavolume</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">vm-alpine-datavolume</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">runStrategy</span><span class="pi">:</span> <span class="s">Halted</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">kubevirt.io/vm</span><span class="pi">:</span> <span class="s">vm-alpine-datavolume</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">domain</span><span class="pi">:</span>
        <span class="na">devices</span><span class="pi">:</span>
          <span class="na">disks</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">disk</span><span class="pi">:</span>
                <span class="na">bus</span><span class="pi">:</span> <span class="s">virtio</span>
              <span class="na">name</span><span class="pi">:</span> <span class="s">datavolumedisk1</span>
        <span class="na">resources</span><span class="pi">:</span>
          <span class="na">requests</span><span class="pi">:</span>
            <span class="na">memory</span><span class="pi">:</span> <span class="s">64M</span>
      <span class="na">volumes</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">dataVolume</span><span class="pi">:</span> <span class="c1">#Note the type is dataVolume</span>
            <span class="na">name</span><span class="pi">:</span> <span class="s">alpine-dv</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">datavolumedisk1</span>
  <span class="na">dataVolumeTemplates</span><span class="pi">:</span> <span class="c1"># Automatically a PVC of size 2Gi is created</span>
    <span class="pi">-</span> <span class="na">metadata</span><span class="pi">:</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">alpine-dv</span>
      <span class="na">spec</span><span class="pi">:</span>
        <span class="na">pvc</span><span class="pi">:</span>
          <span class="na">accessModes</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">ReadWriteOnce</span>
          <span class="na">resources</span><span class="pi">:</span>
            <span class="na">requests</span><span class="pi">:</span>
              <span class="na">storage</span><span class="pi">:</span> <span class="s">2Gi</span>
        <span class="na">source</span><span class="pi">:</span> <span class="c1">#This is the source where the ISO file resides</span>
          <span class="na">http</span><span class="pi">:</span>
            <span class="na">url</span><span class="pi">:</span> <span class="s">http://cdi-http-import-server.kubevirt/images/alpine.iso</span>
</code></pre></div></div>

<p>From the above manifest the two main sections that needs an attention are <strong><code class="language-plaintext highlighter-rouge">source</code></strong> and <strong><code class="language-plaintext highlighter-rouge">pvc</code></strong>.</p>

<p>The <code class="language-plaintext highlighter-rouge">source</code> part declares that there is a disk image living on an http server that we want to use as a volume for this VM. The <code class="language-plaintext highlighter-rouge">pvc</code> part declares the spec that should be used to create the pvc that hosts the source data.</p>

<p>When this VM manifest is posted to the cluster, as part of the launch flow a pvc will be created using the spec provided and the source data will be automatically imported into that pvc before the VM starts. When the VM is deleted, the storage provisioned by the DataVolume will automatically be deleted as well.</p>

<h4 id="a-few-caveats-to-be-considered-before-using-datavolumes">A few caveats to be considered before using DataVolumes</h4>

<p>A DataVolume is a custom resource provided by the Containerized Data Importer (CDI) project. KubeVirt integrates with CDI in order to provide users a workflow for dynamically creating pvcs and importing data into those pvcs.</p>

<p>In order to take advantage of the <code class="language-plaintext highlighter-rouge">DataVolume</code> volume source on a VM or VMI, the DataVolumes feature gate must be enabled in the <code class="language-plaintext highlighter-rouge">kubevirt-config</code> config map before KubeVirt is installed. CDI must also be installed(follow the steps as mentioned above).</p>

<h4 id="enabling-the-datavolumes-feature-gate">Enabling the DataVolumes feature gate</h4>

<p>Below is an example of how to enable DataVolume support using the kubevirt-config config map.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh"> | kubectl create -f -
apiVersion: v1
kind: ConfigMap
metadata:
  name: kubevirt-config
  namespace: kubevirt
  labels:
    kubevirt.io: ""
data:
  feature-gates: "DataVolumes"
</span><span class="no">EOF
</span></code></pre></div></div>

<p>This config map assumes KubeVirt will be installed in the KubeVirt namespace. Change the namespace to suit your installation.</p>

<p>First post the configmap above, then install KubeVirt. At that point DataVolume integration will be enabled.</p>

<h2 id="wrap-up">Wrap-up</h2>

<p>As demonstrated, VM can be imported as a k8s object using a CDI project along with KubeVirt. For more detailed insights, please feel free to follow the <a href="https://kubevirt.io/">KubeVirt project</a>.</p>

        </article>
        
        

<a class="twitter-share-button" href="https://twitter.com/intent/tweet?text=How to import VM into KubeVirt&url=https://www.kubevirt.io/2019/How-To-Import-VM-into-Kubevirt.html&screen_name=kubevirt" aria-label="Share this on Twitter">
  <i class="fab fa-twitter mr-1"></i> Tweet
</a>
<hr/>


      </div>
    </div>
  </div>
</div>
<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe.
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides.
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo https://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>
<script src="/js/photoswipe-page.js">
</script>

    </main>

    <footer class="footer" role="footer">
      <div class="container-fluid">
  <div class="row justify-content-between">
    <div class="col-sm-12 col-md-5">
      <p>We are a <a href="https://cncf.io/">Cloud Native Computing Foundation</a> incubating project.</p>
      <p><a href="https://cncf.io/"><img src="/assets/images/cncf-color.png" alt="Cloud Native Computing Foundation"/></a></p>
    </div>
    <div class="col-sm-12 col-md-5" style="text-align: center;">
      <p class="text-md-right">

        <a href="https://twitter.com/kubevirt" data-toggle="tooltip" data-placement="top" title="Follow us on Twitter!" aria-label="Visit us on Twitter" class="link-social-twitter">
          <i class="fab fa-twitter fa-lg"></i>
        </a>

        <a href="https://kubernetes.slack.com/archives/C8ED7RKFE" data-toggle="tooltip" data-placement="top" title="Join our Slack channel!" class="link-social-slack">
          <i class="fab fa-slack fa-lg"></i>
        </a>

        <a href="https://github.com/kubevirt" data-toggle="tooltip" data-placement="top" title="Check our GitHub!" class="link-social-github">
          <i class="fab fa-github fa-lg"></i>
        </a>

        <a href="https://groups.google.com/forum/#!forum/kubevirt-dev" data-toggle="tooltip" data-placement="top" title="Join our mailing list!" class="link-social-mail">
          <i class="fas fa-envelope fa-lg"></i>
        </a>

        <a href="https://calendar.google.com/calendar/u/0/embed?src=kubevirt@cncf.io" data-toggle="tooltip" data-placement="top" title="See our events calendar!" class="link-social-calendar">
          <i class="fas fa-calendar fa-lg"></i>
        </a>

        <a href="https://www.youtube.com/channel/UC2FH36TbZizw25pVT1P3C3g/videos" data-toggle="tooltip" data-placement="top" title="Subscribe to our YouTube channel!" class="link-social-youtube">
          <i class="fab fa-youtube fa-lg"></i>
        </a>
        
        <a href="https://bsky.app/profile/kubevirt.bsky.social" data-toggle="tooltip" data-placement="top" title="Follow us on Bluesky!" class="link-social-bluesky">
          <i class="fa-brands fa-bluesky fa-lg"></i>
        </a>

        <a href="https://fosstodon.org/@kubevirt" rel="me" data-toggle="tooltip" data-placement="top" title="Follow us on Mastodon!" class="link-social-mastodon">
          <i class="fab fa-mastodon fa-lg"></i>
        </a>

      </p>
    </div>
  </div>
  <div class="row">
    <div class="col text-sm-left footer-licensing" style="text-align: center;">
      Copyright 2025 The KubeVirt Contributors<br>
      Copyright 2025 The Linux Foundation. All Rights Reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage">Trademark Usage</a> page.<br>
      This site is powered by <a href="https://www.netlify.com/legal/open-source-policy/">Netlify</a>.
      <p class="privacy-statement text-sm-left" style="text-align: center;">
        <a href="/privacy" class="privacy-statement-link">Privacy Statement</a>
      </p>
  </div>
</div>
<script src="/js/copy.js"></script>

    </footer>

    <script defer src="https://use.fontawesome.com/releases/v5.1.0/js/all.js" integrity="sha384-3LK/3kTpDE/Pkp8gTNp2gR/2gOiwQ6QaO7Td0zV76UFJVhqLl4Vl3KL1We6q6wR9" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>
    <script src="/js/kubevirt-io.js"></script>
    <!-- Photoswipe -->
    <!-- Core JS file -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/photoswipe.min.js"></script>
    <!-- UI JS file -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>

    <!-- This comes from DTM/DPAL and must be latest entry in body-->

    <script type="text/javascript">
        if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
            _satellite.pageBottom();
        }
    </script>
  </body>
</html>
